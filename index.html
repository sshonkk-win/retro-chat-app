<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Chat App</title>
    <link rel="stylesheet" href="https://jdan.github.io/98.css/98.css">
    <style>
        body {
            background-color: #c0c0c0;
        }
        .chat-window, .registration-window {
            width: 600px;
            border: 2px solid #000;
            margin: 20px auto;
            background-color: #fff;
            display: none; /* Initially hidden */
            overflow: hidden; /* Prevent overflow */
        }
        .messages {
            height: 300px; /* Fixed height for messages */
            overflow-y: auto;
            padding: 5px;
            border-bottom: 2px solid #000;
        }
        .input-area {
            padding: 5px;
        }
        #messageInput {
            width: calc(100% - 70px);
        }
        .registration-input {
            width: calc(100% - 60px);
            margin-bottom: 10px;
        }
        .room-button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="window registration-window" id="registrationWindow">
        <div class="title-bar">
            <div class="title-bar-text">Register</div>
            <div class="title-bar-controls">
                <button aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <input type="text" id="usernameInput" placeholder="Enter your username" class="text-input registration-input">
            <button id="registerButton" class="button">Register</button>
        </div>
    </div>

    <div class="window chat-window" id="chatWindow">
        <div class="title-bar">
            <div class="title-bar-text">Retro Chat App</div>
            <div class="title-bar-controls">
                <button aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <div class="input-area">
                <button id="room1Button" class="button room-button">Room 1</button>
                <button id="room2Button" class="button room-button">Room 2</button>
            </div>
            <div class="messages" id="messages">
                <p>Welcome to the Retro Chat App! Please register to start chatting.</p>
            </div>
            <div class="input-area">
                <input type="text" id="messageInput" placeholder="Type your message..." class="text-input">
                <button id="sendButton" class="button" disabled>Send</button>
            </div>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const usernameInput = document.getElementById('usernameInput');
        const registerButton = document.getElementById('registerButton');
        const chatWindow = document.getElementById('chatWindow');
        const registrationWindow = document.getElementById('registrationWindow');

        let username = '';
        let currentRoom = 'Room 1';
        const rooms = {
            'Room 1': [],
            'Room 2': [],
        };

        // Load username from localStorage if available
        if (localStorage.getItem('username')) {
            username = localStorage.getItem('username');
            registrationWindow.style.display = 'none'; // Hide registration window
            chatWindow.style.display = 'block'; // Show chat window
            updateMessages();
            sendButton.disabled = false; // Enable send button
        } else {
            // Show registration window if no username is set
            registrationWindow.style.display = 'block';
        }

        // Registration functionality
        registerButton.addEventListener('click', () => {
            const inputUsername = usernameInput.value.trim();
            if (inputUsername) {
                username = inputUsername;
                localStorage.setItem('username', username); // Save username to localStorage
                registrationWindow.style.display = 'none'; // Hide registration window
                chatWindow.style.display = 'block'; // Show chat window
                updateMessages();
                sendButton.disabled = false; // Enable send button
            }
        });

        // Switching rooms
        function switchRoom(room) {
            currentRoom = room;
            updateMessages();
        }

        document.getElementById('room1Button').addEventListener('click', () => switchRoom('Room 1'));
        document.getElementById('room2Button').addEventListener('click', () => switchRoom('Room 2'));

        // Sending messages
        sendButton.addEventListener('click', () => {
            const messageText = messageInput.value.trim();
            if (messageText) {
                rooms[currentRoom].push(`${username}: ${messageText}`);
                messageInput.value = ''; // Clear input
                updateMessages();
            }
        });

        // Update messages display
        function updateMessages() {
            messagesContainer.innerHTML = `<p>${username} has joined ${currentRoom}!</p>`;
            rooms[currentRoom].forEach(msg => {
                const messageElement = document.createElement('p');
                messageElement.textContent = msg;
                messagesContainer.appendChild(messageElement);
            });
            messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to bottom
        }

        // Enable sending messages with Enter key
        messageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendButton.click();
            }
        });
    </script>
</body>
</html>
